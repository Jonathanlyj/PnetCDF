#!/bin/bash  -l

#SBATCH --job-name=pnetcdf_test
#SBATCH --qos=debug
#SBATCH -t 00:05:00
#SBATCH --nodes=1
#SBATCH -o out.%j
#SBATCH -e out.%j
#SBATCH --constraint=cpu
#SBATCH --tasks-per-node=4

cd $PWD

set -e

OUT_DIR=__OUT_DIR__

for exec in __TEST_PROGS__
do
   OUTFILE="$OUT_DIR/$exec.nc"
   if test $exec = pres_temp_4D_rd ; then
      OUTFILE="$OUT_DIR/pres_temp_4D_wr.nc"
   fi
   CMD="__RUN_CMD__ -n 4 $exec $OUTFILE"
   $CMD
done

for exec in __EXAMPLE_PROGS__
do
   OUTFILE="$OUT_DIR/$exec.nc"
   if test $exec = get_vara ; then
      OUTFILE="$OUT_DIR/put_vara.nc"
   fi
   CMD="__RUN_CMD__ -n 4 $exec -q $OUTFILE"
   $CMD
   extension="${exec##*.}"
   if test $extension = exe90 ; then
      printf '*** TESTING F90 %-50s ------ pass\n' "$exec"
   elif test $extension = exe77 ; then
      printf '*** TESTING F77 %-50s ------ pass\n' "$exec"
   else
      printf '*** TESTING C   %-50s ------ pass\n' "$exec"
   fi
done

